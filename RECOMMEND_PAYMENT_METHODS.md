# ğŸ’³ Recommend: PhÆ°Æ¡ng Thá»©c Thanh ToÃ¡n An ToÃ n

## ğŸ¯ Tá»•ng Quan

Hiá»‡n táº¡i há»‡ thá»‘ng há»— trá»£:

- âœ… **VNPay** - Tá»± Ä‘á»™ng callback â­â­â­â­â­
- âœ… **MoMo** - Tá»± Ä‘á»™ng callback â­â­â­â­â­
- âš ï¸ **Chuyá»ƒn khoáº£n** - Cáº§n kÃ­ch hoáº¡t thá»§ cÃ´ng â­â­

## ğŸ† Top Recommendations

### 1. VNPay (Khuyáº¿n Nghá»‹ Nháº¥t) â­â­â­â­â­

**Æ¯u Ä‘iá»ƒm:**

- âœ… Tá»± Ä‘á»™ng callback â†’ Tá»± Ä‘á»™ng kÃ­ch hoáº¡t
- âœ… Há»— trá»£ nhiá»u ngÃ¢n hÃ ng (ATM, Visa, MasterCard)
- âœ… Báº£o máº­t cao (SSL, 3D Secure)
- âœ… PhÃ­ tháº¥p (1.5% - 2%)
- âœ… Dá»… tÃ­ch há»£p
- âœ… Há»— trá»£ 24/7

**NhÆ°á»£c Ä‘iá»ƒm:**

- âš ï¸ Cáº§n Ä‘Äƒng kÃ½ doanh nghiá»‡p
- âš ï¸ Thá»i gian duyá»‡t: 3-5 ngÃ y

**ÄÄƒng kÃ½:**

```
1. Truy cáº­p: https://vnpay.vn
2. ÄÄƒng kÃ½ tÃ i khoáº£n doanh nghiá»‡p
3. Cung cáº¥p giáº¥y tá»: GPKD, CMND, giáº¥y phÃ©p kinh doanh
4. Chá» duyá»‡t 3-5 ngÃ y
5. Nháº­n Merchant ID vÃ  Secret Key
6. TÃ­ch há»£p vÃ o website
```

**Chi phÃ­:**

- PhÃ­ giao dá»‹ch: 1.5% - 2%
- PhÃ­ setup: Miá»…n phÃ­
- PhÃ­ duy trÃ¬: Miá»…n phÃ­

---

### 2. MoMo (Khuyáº¿n Nghá»‹) â­â­â­â­â­

**Æ¯u Ä‘iá»ƒm:**

- âœ… Tá»± Ä‘á»™ng callback â†’ Tá»± Ä‘á»™ng kÃ­ch hoáº¡t
- âœ… Phá»• biáº¿n táº¡i Viá»‡t Nam
- âœ… Thanh toÃ¡n nhanh (QR code)
- âœ… KhÃ´ng cáº§n tháº» ngÃ¢n hÃ ng
- âœ… PhÃ­ cáº¡nh tranh (1.5% - 2.5%)
- âœ… Dá»… tÃ­ch há»£p

**NhÆ°á»£c Ä‘iá»ƒm:**

- âš ï¸ Cáº§n Ä‘Äƒng kÃ½ doanh nghiá»‡p
- âš ï¸ Giá»›i háº¡n giao dá»‹ch (50 triá»‡u/ngÃ y)

**ÄÄƒng kÃ½:**

```
1. Truy cáº­p: https://business.momo.vn
2. ÄÄƒng kÃ½ tÃ i khoáº£n doanh nghiá»‡p
3. Cung cáº¥p giáº¥y tá»
4. Chá» duyá»‡t 3-7 ngÃ y
5. Nháº­n Partner Code vÃ  Secret Key
6. TÃ­ch há»£p vÃ o website
```

**Chi phÃ­:**

- PhÃ­ giao dá»‹ch: 1.5% - 2.5%
- PhÃ­ setup: Miá»…n phÃ­
- PhÃ­ duy trÃ¬: Miá»…n phÃ­

---

### 3. ZaloPay â­â­â­â­

**Æ¯u Ä‘iá»ƒm:**

- âœ… Tá»± Ä‘á»™ng callback
- âœ… TÃ­ch há»£p vá»›i Zalo (nhiá»u user)
- âœ… Thanh toÃ¡n nhanh
- âœ… PhÃ­ tháº¥p (1.5% - 2%)

**NhÆ°á»£c Ä‘iá»ƒm:**

- âš ï¸ Ãt phá»• biáº¿n hÆ¡n MoMo
- âš ï¸ Cáº§n Ä‘Äƒng kÃ½ doanh nghiá»‡p

**ÄÄƒng kÃ½:**

```
1. Truy cáº­p: https://zalopay.vn/business
2. ÄÄƒng kÃ½ tÃ i khoáº£n
3. Cung cáº¥p giáº¥y tá»
4. Chá» duyá»‡t
5. TÃ­ch há»£p
```

---

### 4. VietQR (Chuyá»ƒn Khoáº£n Tá»± Äá»™ng) â­â­â­â­â­

**Æ¯u Ä‘iá»ƒm:**

- âœ… **Tá»± Ä‘á»™ng xÃ¡c nháº­n** qua API ngÃ¢n hÃ ng
- âœ… KhÃ´ng cáº§n Ä‘Äƒng kÃ½ cá»•ng thanh toÃ¡n
- âœ… PhÃ­ tháº¥p (0% - 0.5%)
- âœ… Há»— trá»£ táº¥t cáº£ ngÃ¢n hÃ ng
- âœ… QR code tá»± Ä‘á»™ng
- âœ… Matching tá»± Ä‘á»™ng

**CÃ¡ch hoáº¡t Ä‘á»™ng:**

```
1. KhÃ¡ch quÃ©t QR â†’ Chuyá»ƒn khoáº£n
2. Ná»™i dung: MÃ£ Ä‘Æ¡n hÃ ng (ORD123456)
3. API ngÃ¢n hÃ ng webhook â†’ Server
4. Server matching mÃ£ Ä‘Æ¡n
5. Tá»± Ä‘á»™ng kÃ­ch hoáº¡t subscription
```

**TÃ­ch há»£p:**

```javascript
// Frontend: Táº¡o QR code
const qrUrl = `https://img.vietqr.io/image/${bankCode}-${accountNo}-compact2.jpg?amount=${amount}&addInfo=${orderCode}`;

// Backend: Webhook tá»« ngÃ¢n hÃ ng
app.post("/webhook/bank", (req, res) => {
  const { amount, content } = req.body;

  // Extract order code tá»« content
  const orderCode = extractOrderCode(content);

  // TÃ¬m order
  const order = findOrder(orderCode);

  // Kiá»ƒm tra sá»‘ tiá»n
  if (order.total === amount) {
    // KÃ­ch hoáº¡t tá»± Ä‘á»™ng
    activateSubscription(orderCode);
  }
});
```

**NgÃ¢n hÃ ng há»— trá»£ API:**

- âœ… VCB (Vietcombank) - API Corporate
- âœ… TCB (Techcombank) - Open API
- âœ… MB (MB Bank) - Open API
- âœ… ACB - Open API
- âœ… VPBank - Open API

**Chi phÃ­:**

- PhÃ­ giao dá»‹ch: 0% (chuyá»ƒn khoáº£n thÆ°á»ng)
- PhÃ­ API: 500k - 2 triá»‡u/thÃ¡ng (tÃ¹y ngÃ¢n hÃ ng)
- PhÃ­ setup: Miá»…n phÃ­

---

### 5. Casso (Tá»± Äá»™ng Äá»‘i SoÃ¡t) â­â­â­â­â­

**Æ¯u Ä‘iá»ƒm:**

- âœ… **Tá»± Ä‘á»™ng Ä‘á»‘i soÃ¡t** giao dá»‹ch ngÃ¢n hÃ ng
- âœ… Webhook real-time
- âœ… Há»— trá»£ 30+ ngÃ¢n hÃ ng
- âœ… KhÃ´ng cáº§n API ngÃ¢n hÃ ng
- âœ… Dá»… tÃ­ch há»£p
- âœ… Dashboard quáº£n lÃ½

**CÃ¡ch hoáº¡t Ä‘á»™ng:**

```
1. Káº¿t ná»‘i tÃ i khoáº£n ngÃ¢n hÃ ng vá»›i Casso
2. Casso theo dÃµi giao dá»‹ch real-time
3. CÃ³ giao dá»‹ch má»›i â†’ Webhook Ä‘áº¿n server
4. Server matching mÃ£ Ä‘Æ¡n
5. Tá»± Ä‘á»™ng kÃ­ch hoáº¡t
```

**ÄÄƒng kÃ½:**

```
1. Truy cáº­p: https://casso.vn
2. ÄÄƒng kÃ½ tÃ i khoáº£n
3. Káº¿t ná»‘i ngÃ¢n hÃ ng (SMS Banking hoáº·c Internet Banking)
4. Cáº¥u hÃ¬nh webhook
5. TÃ­ch há»£p vÃ o website
```

**Chi phÃ­:**

- GÃ³i Free: 0Ä‘ (100 giao dá»‹ch/thÃ¡ng)
- GÃ³i Basic: 99k/thÃ¡ng (1000 giao dá»‹ch)
- GÃ³i Pro: 299k/thÃ¡ng (khÃ´ng giá»›i háº¡n)

**TÃ­ch há»£p:**

```php
// Webhook tá»« Casso
Route::post('/webhook/casso', function(Request $request) {
    $data = $request->all();

    // Láº¥y thÃ´ng tin giao dá»‹ch
    $amount = $data['amount'];
    $description = $data['description'];

    // Extract order code
    preg_match('/ORD\d+/', $description, $matches);
    $orderCode = $matches[0] ?? null;

    if ($orderCode) {
        // TÃ¬m order
        $order = Order::where('order_code', $orderCode)->first();

        // Kiá»ƒm tra sá»‘ tiá»n
        if ($order && $order->total == $amount) {
            // KÃ­ch hoáº¡t tá»± Ä‘á»™ng
            activateSubscription($orderCode);

            return response()->json(['success' => true]);
        }
    }

    return response()->json(['success' => false]);
});
```

---

### 6. PayOS (Má»›i, Hiá»‡n Äáº¡i) â­â­â­â­â­

**Æ¯u Ä‘iá»ƒm:**

- âœ… Tá»± Ä‘á»™ng callback
- âœ… Há»— trá»£ nhiá»u phÆ°Æ¡ng thá»©c (QR, ATM, Visa)
- âœ… PhÃ­ tháº¥p (1.5%)
- âœ… Dashboard Ä‘áº¹p
- âœ… API hiá»‡n Ä‘áº¡i (RESTful)
- âœ… Webhook real-time

**ÄÄƒng kÃ½:**

```
1. Truy cáº­p: https://payos.vn
2. ÄÄƒng kÃ½ nhanh (khÃ´ng cáº§n GPKD)
3. XÃ¡c thá»±c tÃ i khoáº£n
4. Nháº­n API Key
5. TÃ­ch há»£p
```

**Chi phÃ­:**

- PhÃ­ giao dá»‹ch: 1.5%
- PhÃ­ setup: Miá»…n phÃ­
- PhÃ­ duy trÃ¬: Miá»…n phÃ­

---

## ğŸ“Š So SÃ¡nh

| PhÆ°Æ¡ng thá»©c      | Tá»± Ä‘á»™ng | PhÃ­           | Dá»… Ä‘Äƒng kÃ½ | Phá»• biáº¿n   | Tá»•ng Ä‘iá»ƒm  |
| ---------------- | ------- | ------------- | ---------- | ---------- | ---------- |
| **VNPay**        | âœ…      | 1.5-2%        | âš ï¸         | â­â­â­â­â­ | â­â­â­â­â­ |
| **MoMo**         | âœ…      | 1.5-2.5%      | âš ï¸         | â­â­â­â­â­ | â­â­â­â­â­ |
| **ZaloPay**      | âœ…      | 1.5-2%        | âš ï¸         | â­â­â­     | â­â­â­â­   |
| **VietQR + API** | âœ…      | 0-0.5%        | âš ï¸âš ï¸       | â­â­â­â­   | â­â­â­â­â­ |
| **Casso**        | âœ…      | 99-299k/thÃ¡ng | âœ…         | â­â­â­â­   | â­â­â­â­â­ |
| **PayOS**        | âœ…      | 1.5%          | âœ…         | â­â­â­     | â­â­â­â­â­ |
| **Chuyá»ƒn khoáº£n** | âŒ      | 0%            | âœ…         | â­â­â­â­â­ | â­â­       |

---

## ğŸ¯ Khuyáº¿n Nghá»‹ Cho HTHREE Film

### Giáº£i PhÃ¡p Tá»‘i Æ¯u (Káº¿t Há»£p)

#### Phase 1: Ngay Láº­p Tá»©c

```
âœ… VNPay (chÃ­nh)
âœ… MoMo (phá»¥)
âœ… Casso (cho chuyá»ƒn khoáº£n tá»± Ä‘á»™ng)
```

**LÃ½ do:**

- VNPay + MoMo: Phá»• biáº¿n, tá»± Ä‘á»™ng 100%
- Casso: Giáº£i quyáº¿t váº¥n Ä‘á» chuyá»ƒn khoáº£n thá»§ cÃ´ng

#### Phase 2: Sau 1-2 ThÃ¡ng

```
âœ… ThÃªm ZaloPay
âœ… ThÃªm PayOS
```

#### Phase 3: TÆ°Æ¡ng Lai

```
âœ… TÃ­ch há»£p API ngÃ¢n hÃ ng trá»±c tiáº¿p (VietQR)
âœ… Crypto payment (USDT, Bitcoin)
```

---

## ğŸ”§ TÃ­ch Há»£p Casso (Khuyáº¿n Nghá»‹)

### BÆ°á»›c 1: ÄÄƒng KÃ½

```
1. VÃ o https://casso.vn
2. ÄÄƒng kÃ½ tÃ i khoáº£n
3. Káº¿t ná»‘i ngÃ¢n hÃ ng
4. Láº¥y Webhook URL vÃ  Secret Key
```

### BÆ°á»›c 2: Táº¡o Webhook Endpoint

```php
// backend/api/webhook/casso.php
<?php
header('Content-Type: application/json');

require_once __DIR__ . '/../../config/database.php';

// Láº¥y data tá»« Casso
$data = json_decode(file_get_contents('php://input'), true);

// Verify signature (báº£o máº­t)
$signature = $_SERVER['HTTP_X_CASSO_SIGNATURE'] ?? '';
$secretKey = 'YOUR_CASSO_SECRET_KEY';
$expectedSignature = hash_hmac('sha256', json_encode($data), $secretKey);

if ($signature !== $expectedSignature) {
    http_response_code(401);
    echo json_encode(['error' => 'Invalid signature']);
    exit;
}

// Láº¥y thÃ´ng tin giao dá»‹ch
$amount = $data['amount'];
$description = $data['description'];
$transactionId = $data['id'];

// Extract order code tá»« description
preg_match('/ORD\d+/', $description, $matches);
$orderCode = $matches[0] ?? null;

if (!$orderCode) {
    echo json_encode(['success' => false, 'message' => 'Order code not found']);
    exit;
}

$conn = getDBConnection();

// TÃ¬m order
$stmt = $conn->prepare("SELECT * FROM orders WHERE order_code = ?");
$stmt->bind_param("s", $orderCode);
$stmt->execute();
$result = $stmt->get_result();
$order = $result->fetch_assoc();

if (!$order) {
    echo json_encode(['success' => false, 'message' => 'Order not found']);
    exit;
}

// Kiá»ƒm tra sá»‘ tiá»n
if ($order['total'] != $amount) {
    echo json_encode(['success' => false, 'message' => 'Amount mismatch']);
    exit;
}

// Kiá»ƒm tra Ä‘Ã£ kÃ­ch hoáº¡t chÆ°a
if ($order['payment_status'] === 'paid') {
    echo json_encode(['success' => true, 'message' => 'Already activated']);
    exit;
}

// KÃ­ch hoáº¡t tá»± Ä‘á»™ng
$conn->begin_transaction();

try {
    // Update order
    $stmt = $conn->prepare("
        UPDATE orders
        SET payment_status = 'paid',
            status = 'completed',
            paid_at = NOW(),
            completed_at = NOW(),
            transaction_id = ?
        WHERE id = ?
    ");
    $stmt->bind_param("si", $transactionId, $order['id']);
    $stmt->execute();

    // KÃ­ch hoáº¡t subscription (gá»i hÃ m cÃ³ sáºµn)
    require_once __DIR__ . '/../payment/activate_subscription.php';
    activateSubscriptionByOrderId($order['id']);

    $conn->commit();

    echo json_encode([
        'success' => true,
        'message' => 'Order activated successfully',
        'order_code' => $orderCode
    ]);

} catch (Exception $e) {
    $conn->rollback();
    echo json_encode(['success' => false, 'message' => $e->getMessage()]);
}
?>
```

### BÆ°á»›c 3: Cáº¥u HÃ¬nh Casso

```
1. VÃ o Casso Dashboard
2. Settings â†’ Webhook
3. Webhook URL: https://yourdomain.com/backend/api/webhook/casso.php
4. Secret Key: LÆ°u vÃ o code
5. Test webhook
6. Save
```

### BÆ°á»›c 4: Test

```bash
# Test webhook
curl -X POST https://yourdomain.com/backend/api/webhook/casso.php \
  -H "Content-Type: application/json" \
  -H "X-Casso-Signature: YOUR_SIGNATURE" \
  -d '{
    "id": "123456",
    "amount": 50000,
    "description": "Thanh toan don hang ORD20251284144",
    "when": "2024-12-04 10:30:00"
  }'
```

---

## ğŸ’° Chi PhÃ­ Æ¯á»›c TÃ­nh

### Scenario: 100 Ä‘Æ¡n/thÃ¡ng, trung bÃ¬nh 100k/Ä‘Æ¡n

| PhÆ°Æ¡ng thá»©c | PhÃ­/Ä‘Æ¡n | Tá»•ng phÃ­/thÃ¡ng | Ghi chÃº            |
| ----------- | ------- | -------------- | ------------------ |
| VNPay (2%)  | 2,000Ä‘  | 200,000Ä‘       | Tá»± Ä‘á»™ng            |
| MoMo (2%)   | 2,000Ä‘  | 200,000Ä‘       | Tá»± Ä‘á»™ng            |
| Casso       | 0Ä‘      | 99,000Ä‘        | GÃ³i Basic          |
| **Tá»•ng**    | -       | **499,000Ä‘**   | **Táº¥t cáº£ tá»± Ä‘á»™ng** |

### So vá»›i Chuyá»ƒn khoáº£n thá»§ cÃ´ng:

- PhÃ­: 0Ä‘
- Thá»i gian admin: 5 phÃºt/Ä‘Æ¡n Ã— 100 Ä‘Æ¡n = **500 phÃºt = 8.3 giá»**
- Chi phÃ­ nhÃ¢n cÃ´ng: 50k/giá» Ã— 8.3 = **415,000Ä‘**

**â†’ Tá»± Ä‘á»™ng hÃ³a Ráºº HÆ N vÃ  NHANH HÆ N!**

---

## ğŸ“ Action Plan

### Tuáº§n 1:

- [ ] ÄÄƒng kÃ½ Casso
- [ ] TÃ­ch há»£p Casso webhook
- [ ] Test vá»›i chuyá»ƒn khoáº£n tháº­t

### Tuáº§n 2:

- [ ] ÄÄƒng kÃ½ VNPay (náº¿u cÃ³ GPKD)
- [ ] Hoáº·c Ä‘Äƒng kÃ½ PayOS (khÃ´ng cáº§n GPKD)

### Tuáº§n 3:

- [ ] ÄÄƒng kÃ½ MoMo
- [ ] TÃ­ch há»£p cáº£ 3 phÆ°Æ¡ng thá»©c

### Tuáº§n 4:

- [ ] Monitor vÃ  optimize
- [ ] ThÃªm analytics

---

**Khuyáº¿n nghá»‹ cuá»‘i cÃ¹ng**: DÃ¹ng **Casso** ngay Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» chuyá»ƒn khoáº£n thá»§ cÃ´ng. Sau Ä‘Ã³ tá»« tá»« thÃªm VNPay vÃ  MoMo.

---

**Cáº­p nháº­t**: 04/12/2024  
**Version**: 2.0.3  
**Status**: âœ… Ready to Implement
