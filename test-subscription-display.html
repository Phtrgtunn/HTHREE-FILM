<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Subscription Display</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { background: #2a2a2a; padding: 20px; margin: 20px 0; border-radius: 8px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #45a049; }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .info { color: #74c0fc; }
        pre { background: #000; padding: 10px; border-radius: 4px; overflow-x: auto; }
        input { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Subscription Display</h1>
        
        <div class="section">
            <h3>1. Mua g√≥i demo</h3>
            <input type="number" id="userId" placeholder="User ID" value="1">
            <select id="planSlug">
                <option value="basic">Basic (30 ph√∫t)</option>
                <option value="premium">Premium (45 ph√∫t)</option>
                <option value="vip">VIP (60 ph√∫t)</option>
            </select>
            <button onclick="buyDemoPlan()">Mua g√≥i demo</button>
            <div id="buyResult"></div>
        </div>

        <div class="section">
            <h3>2. Ki·ªÉm tra subscription</h3>
            <button onclick="checkSubscription()">Ki·ªÉm tra subscription</button>
            <div id="subscriptionResult"></div>
        </div>

        <div class="section">
            <h3>3. Debug m√∫i gi·ªù</h3>
            <button onclick="debugTimezone()" style="background: #74c0fc;">Ki·ªÉm tra m√∫i gi·ªù</button>
            <div id="timezoneResult"></div>
        </div>

        <div class="section">
            <h3>4. Reset subscription (x√≥a t·∫•t c·∫£)</h3>
            <button onclick="resetSubscription()" style="background: #ff6b6b;">Reset t·∫•t c·∫£ subscription</button>
            <div id="resetResult"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost/HTHREE_film/backend/api';

        async function buyDemoPlan() {
            const userId = document.getElementById('userId').value;
            const planSlug = document.getElementById('planSlug').value;
            
            if (!userId) {
                document.getElementById('buyResult').innerHTML = '<div class="error">Vui l√≤ng nh·∫≠p User ID</div>';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/demo/buy_plan_demo.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: parseInt(userId),
                        plan_slug: planSlug
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('buyResult').innerHTML = `
                        <div class="success">‚úÖ Mua g√≥i th√†nh c√¥ng!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('buyResult').innerHTML = `
                        <div class="error">‚ùå L·ªói: ${data.message}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('buyResult').innerHTML = `
                    <div class="error">‚ùå L·ªói k·∫øt n·ªëi: ${error.message}</div>
                `;
            }
        }

        async function checkSubscription() {
            const userId = document.getElementById('userId').value;
            
            if (!userId) {
                document.getElementById('subscriptionResult').innerHTML = '<div class="error">Vui l√≤ng nh·∫≠p User ID</div>';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/user_subscription.php?user_id=${userId}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('subscriptionResult').innerHTML = `
                        <div class="success">‚úÖ T√¨m th·∫•y ${data.count} subscription(s)</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('subscriptionResult').innerHTML = `
                        <div class="error">‚ùå L·ªói: ${data.message}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('subscriptionResult').innerHTML = `
                    <div class="error">‚ùå L·ªói k·∫øt n·ªëi: ${error.message}</div>
                `;
            }
        }

        async function debugTimezone() {
            try {
                const response = await fetch(`${API_URL}/debug/timezone_test.php`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('timezoneResult').innerHTML = `
                        <div class="success">‚úÖ Debug m√∫i gi·ªù th√†nh c√¥ng!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('timezoneResult').innerHTML = `
                        <div class="error">‚ùå L·ªói: ${data.message}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('timezoneResult').innerHTML = `
                    <div class="error">‚ùå L·ªói k·∫øt n·ªëi: ${error.message}</div>
                `;
            }
        }

        async function resetSubscription() {
            const userId = document.getElementById('userId').value;
            
            if (!userId) {
                document.getElementById('resetResult').innerHTML = '<div class="error">Vui l√≤ng nh·∫≠p User ID</div>';
                return;
            }

            if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a T·∫§T C·∫¢ subscription c·ªßa user n√†y?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/reset_and_create_subscription.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_id: parseInt(userId),
                        action: 'reset_only'
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('resetResult').innerHTML = `
                        <div class="success">‚úÖ ƒê√£ reset subscription th√†nh c√¥ng!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    document.getElementById('resetResult').innerHTML = `
                        <div class="error">‚ùå L·ªói: ${data.message}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('resetResult').innerHTML = `
                    <div class="error">‚ùå L·ªói k·∫øt n·ªëi: ${error.message}</div>
                `;
            }
        }

        // Auto-refresh subscription every 5 seconds
        setInterval(() => {
            const userId = document.getElementById('userId').value;
            if (userId && document.getElementById('subscriptionResult').innerHTML.includes('‚úÖ')) {
                checkSubscription();
            }
        }, 5000);
    </script>
</body>
</html>