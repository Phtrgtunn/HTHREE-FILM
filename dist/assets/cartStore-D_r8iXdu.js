import{h as o,a2 as u,z as i}from"./index-C1YtYqPe.js";import{a as p}from"./useErrorHandler-svuVN1QS.js";const n="https://hthree-film-production.up.railway.app/api",C=async(t=!0)=>{try{const r=`${n}/plans.php?active_only=${t}`;return await p.get(r,async()=>(await o.get(r)).data,10*60*1e3)}catch(r){throw console.error("Error fetching plans:",r),r}},d=async t=>{try{return(await o.get(`${n}/cart.php`,{params:{user_id:t}})).data}catch(r){throw console.error("Error fetching cart:",r),r}},g=async(t,r,e=1,a=1)=>{try{return(await o.post(`${n}/cart.php`,{user_id:t,plan_id:r,quantity:e,duration_months:a})).data}catch(s){throw console.error("Error adding to cart:",s),s}},m=async(t,r)=>{try{return(await o.put(`${n}/cart.php`,{cart_id:t,quantity:r})).data}catch(e){throw console.error("Error updating cart:",e),e}},y=async t=>{try{return(await o.delete(`${n}/cart.php`,{params:{cart_id:t}})).data}catch(r){throw console.error("Error removing from cart:",r),r}},f=async t=>{try{return(await o.delete(`${n}/cart.php`,{params:{user_id:t}})).data}catch(r){throw console.error("Error clearing cart:",r),r}},E=async t=>{try{return(await o.post(`${n}/orders.php`,t)).data}catch(r){throw console.error("Error creating order:",r),r}},v=async(t,r,e=null)=>{try{return(await o.post(`${n}/coupons.php`,{code:t,order_value:r,user_id:e})).data}catch(a){throw console.error("Error validating coupon:",a),a}},I=u("cart",{state:()=>({items:[],total:0,count:0,loading:!1,error:null}),getters:{cartCount:t=>t.count,cartTotal:t=>t.total,cartTotalFormatted:t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t.total),isEmpty:t=>t.items.length===0},actions:{async fetchCart(){var e,a;const t=i(),r=((e=t.user)==null?void 0:e.id)||((a=t.user)==null?void 0:a.uid);if(!r){this.items=[],this.total=0,this.count=0;return}this.loading=!0,this.error=null;try{const s=await d(r);s.success&&(this.items=s.data.items,this.total=s.data.total,this.count=s.data.count)}catch(s){this.error=s.message,console.error("Error fetching cart:",s)}finally{this.loading=!1}},async addItem(t,r=1,e=1){var h,l;const a=i(),s=((h=a.user)==null?void 0:h.id)||((l=a.user)==null?void 0:l.uid);if(!s)throw new Error("Vui lòng đăng nhập để thêm vào giỏ hàng");this.loading=!0,this.error=null;try{console.log("Adding to cart:",{userId:s,planId:t,quantity:r,durationMonths:e});const c=await g(s,t,r,e);if(c.success)return await this.fetchCart(),c}catch(c){throw console.error("Error adding to cart:",c),this.error=c.message,c}finally{this.loading=!1}},async updateQuantity(t,r){this.loading=!0,this.error=null;try{const e=await m(t,r);if(e.success)return await this.fetchCart(),e}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async removeItem(t){this.loading=!0,this.error=null;try{const r=await y(t);if(r.success)return await this.fetchCart(),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async clear(){var e,a;const t=i(),r=((e=t.user)==null?void 0:e.id)||((a=t.user)==null?void 0:a.uid);if(r){this.loading=!0,this.error=null;try{(await f(r)).success&&(this.items=[],this.total=0,this.count=0)}catch(s){throw this.error=s.message,s}finally{this.loading=!1}}},hasItem(t){return this.items.some(r=>r.plan_id===t)},getItem(t){return this.items.find(r=>r.plan_id===t)}}});export{E as c,C as g,I as u,v};
