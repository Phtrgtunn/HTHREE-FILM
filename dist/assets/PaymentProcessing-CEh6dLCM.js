import{z as V,r as i,u as z,j as P,k as $,A,g as H,B as N,c as h,a as t,d as R,b as I,t as n,s as g,y as D,n as K,o as m}from"./index-BLiZ3QlF.js";const L={class:"min-h-screen bg-black flex items-center justify-center p-4"},U={class:"max-w-2xl w-full"},E={key:0,class:"text-center"},G={class:"bg-gray-900 rounded-xl p-6 mb-6 border border-green-500/30"},q={class:"flex items-center justify-between mb-4"},X={class:"text-white font-bold"},F={class:"flex items-center justify-between mb-4"},W={class:"text-green-400 font-bold"},J={class:"flex items-center justify-between"},O={class:"text-white font-bold"},Q={class:"flex gap-3"},Y={key:1,class:"text-center"},Z={class:"mb-6"},tt={class:"text-sm text-gray-500"},et={class:"bg-gray-900 rounded-xl p-6 mb-6 border border-gray-800"},st={class:"flex items-start gap-3 mb-4"},nt={class:"flex-1"},ot={class:"flex items-center gap-2 text-sm"},lt={class:"flex-1 bg-gray-800 rounded-full h-2 overflow-hidden"},at={class:"text-gray-400 text-xs"},rt={class:"border-t border-gray-800 pt-4"},it={class:"flex items-center justify-between text-sm mb-1"},dt={class:"text-white font-mono"},ct={class:"flex items-center justify-between text-sm"},ut={class:"text-yellow-400 font-bold"},ht={class:"flex gap-3"},gt=["disabled"],mt={key:2,class:"text-center"},pt={class:"mb-6"},vt={class:"text-gray-400 mb-6"},xt={class:"flex gap-3"},T=1e4,ft=3e5,wt={__name:"PaymentProcessing",setup(bt){const M=z(),d=H(),x=A(),w=V(),p=i(M.query.order_code||""),a=i("pending"),c=i(null),u=i(!1),f=i(""),B=i(Date.now()),b=i(300),S=P(()=>{const r=Date.now()-B.value;return Math.min(100,r/ft*100)});let o=null,l=null;const k=r=>new Intl.NumberFormat("vi-VN").format(r),y=async()=>{if(!p.value){f.value="KhÃ´ng tÃ¬m tháº¥y mÃ£ Ä‘Æ¡n hÃ ng",a.value="failed";return}u.value=!0;try{const s=await(await fetch(`https://hthree-film-production.up.railway.app/api/check_order_status.php?order_code=${p.value}`)).json();if(s.success)c.value=s.order,s.order.status==="completed"&&s.order.payment_status==="paid"?(a.value="completed",x.success("ğŸ‰ Thanh toÃ¡n thÃ nh cÃ´ng! GÃ³i cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c kÃ­ch hoáº¡t."),w.user&&await w.refreshUserData(),o&&clearInterval(o),l&&clearInterval(l)):s.order.payment_status==="failed"&&(a.value="failed",f.value=s.order.payment_note||"Thanh toÃ¡n tháº¥t báº¡i",o&&clearInterval(o),l&&clearInterval(l));else throw new Error(s.message||"KhÃ´ng thá»ƒ kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng")}catch(r){console.error("Error checking payment status:",r)}finally{u.value=!1}};return $(()=>{if(!p.value){x.error("KhÃ´ng tÃ¬m tháº¥y mÃ£ Ä‘Æ¡n hÃ ng"),d.push("/pricing");return}y(),o=setInterval(()=>{y()},T),l=setInterval(()=>{b.value--,b.value<=0&&(clearInterval(o),clearInterval(l),a.value==="pending"&&x.warning("Háº¿t thá»i gian chá». Vui lÃ²ng kiá»ƒm tra láº¡i trong trang tÃ i khoáº£n."))},1e3)}),N(()=>{o&&clearInterval(o),l&&clearInterval(l)}),(r,e)=>{var s,_,C,j;return m(),h("div",L,[t("div",U,[a.value==="completed"?(m(),h("div",E,[e[8]||(e[8]=I('<div class="mb-6"><div class="w-24 h-24 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce"><svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg></div><h1 class="text-3xl font-bold text-white mb-2">ğŸ‰ Thanh toÃ¡n thÃ nh cÃ´ng!</h1><p class="text-gray-400 mb-6">GÃ³i cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c kÃ­ch hoáº¡t</p></div>',1)),t("div",G,[t("div",q,[e[5]||(e[5]=t("span",{class:"text-gray-400"},"GÃ³i Ä‘Ã£ mua:",-1)),t("span",X,n((s=c.value)==null?void 0:s.plan_name),1)]),t("div",F,[e[6]||(e[6]=t("span",{class:"text-gray-400"},"Sá»‘ tiá»n:",-1)),t("span",W,n(k((_=c.value)==null?void 0:_.total))+"Ä‘",1)]),t("div",J,[e[7]||(e[7]=t("span",{class:"text-gray-400"},"Thá»i háº¡n:",-1)),t("span",O,n((C=c.value)==null?void 0:C.duration)+" ngÃ y",1)])]),t("div",Q,[t("button",{onClick:e[0]||(e[0]=v=>g(d).push("/account")),class:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded-lg transition-all"}," Xem gÃ³i cá»§a tÃ´i "),t("button",{onClick:e[1]||(e[1]=v=>g(d).push("/home")),class:"flex-1 bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-all"}," Xem phim ngay ")])])):a.value==="pending"?(m(),h("div",Y,[t("div",Z,[e[9]||(e[9]=I('<div class="w-24 h-24 bg-yellow-500/20 rounded-full flex items-center justify-center mx-auto mb-4"><svg class="w-12 h-12 text-yellow-400 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg></div><h1 class="text-3xl font-bold text-white mb-2">Äang xá»­ lÃ½ thanh toÃ¡n...</h1><p class="text-gray-400 mb-2">Vui lÃ²ng Ä‘á»£i trong giÃ¢y lÃ¡t</p>',3)),t("p",tt,"Tá»± Ä‘á»™ng kiá»ƒm tra má»—i "+n(T/1e3)+"s",1)]),t("div",et,[t("div",st,[e[12]||(e[12]=t("svg",{class:"w-6 h-6 text-blue-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t("div",nt,[e[10]||(e[10]=t("h3",{class:"text-white font-bold mb-2"},"ÄÃ£ chuyá»ƒn khoáº£n?",-1)),e[11]||(e[11]=t("p",{class:"text-gray-400 text-sm mb-3"}," Há»‡ thá»‘ng Ä‘ang tá»± Ä‘á»™ng kiá»ƒm tra giao dá»‹ch cá»§a báº¡n. ThÆ°á»ng máº¥t 10-30 giÃ¢y. ",-1)),t("div",ot,[t("div",lt,[t("div",{class:"bg-yellow-400 h-full transition-all duration-1000",style:D({width:S.value+"%"})},null,4)]),t("span",at,n(b.value)+"s",1)])])]),t("div",rt,[e[15]||(e[15]=t("p",{class:"text-gray-400 text-sm mb-2"},"ThÃ´ng tin Ä‘Æ¡n hÃ ng:",-1)),t("div",it,[e[13]||(e[13]=t("span",{class:"text-gray-500"},"MÃ£ Ä‘Æ¡n:",-1)),t("span",dt,n(p.value),1)]),t("div",ct,[e[14]||(e[14]=t("span",{class:"text-gray-500"},"Sá»‘ tiá»n:",-1)),t("span",ut,n(k((j=c.value)==null?void 0:j.total))+"Ä‘",1)])])]),t("div",ht,[t("button",{onClick:y,disabled:u.value,class:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded-lg transition-all disabled:opacity-50 flex items-center justify-center gap-2"},[(m(),h("svg",{class:K(["w-5 h-5",{"animate-spin":u.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e[16]||(e[16]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)]),2)),t("span",null,n(u.value?"Äang kiá»ƒm tra...":"Kiá»ƒm tra ngay"),1)],8,gt),t("button",{onClick:e[2]||(e[2]=v=>g(d).push("/account")),class:"flex-1 bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-all"}," Vá» trang tÃ i khoáº£n ")])])):a.value==="failed"?(m(),h("div",mt,[t("div",pt,[e[17]||(e[17]=t("div",{class:"w-24 h-24 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-12 h-12 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[18]||(e[18]=t("h1",{class:"text-3xl font-bold text-white mb-2"},"Thanh toÃ¡n tháº¥t báº¡i",-1)),t("p",vt,n(f.value||"CÃ³ lá»—i xáº£y ra trong quÃ¡ trÃ¬nh xá»­ lÃ½"),1)]),e[19]||(e[19]=t("div",{class:"bg-red-500/10 border border-red-500/30 rounded-xl p-6 mb-6"},[t("p",{class:"text-red-400 text-sm"}," Náº¿u báº¡n Ä‘Ã£ chuyá»ƒn khoáº£n, vui lÃ²ng liÃªn há»‡ support Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£. ")],-1)),t("div",xt,[t("button",{onClick:e[3]||(e[3]=v=>g(d).push("/pricing")),class:"flex-1 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded-lg transition-all"}," Thá»­ láº¡i "),t("button",{onClick:e[4]||(e[4]=v=>g(d).push("/account")),class:"flex-1 bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-all"}," Vá» trang tÃ i khoáº£n ")])])):R("",!0)])])}}};export{wt as default};
