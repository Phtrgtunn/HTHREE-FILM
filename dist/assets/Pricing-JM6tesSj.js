import{_ as G,r as c,k as te,B as ue,A as X,c as i,o as l,d as f,a as e,b as Y,l as J,t as r,n as _,m as se,q as H,a6 as ce,T as oe,s as ge,g as ne,z as ae,j as le,x as q,f as F,a7 as W,F as U,U as re,S as K,a3 as pe,w as he,a8 as me,I as ve,G as be,e as Z,y as ee}from"./index-k_O4NoZj.js";import{u as fe,g as xe}from"./cartStore-DZIQNt4v.js";import"./useErrorHandler-svuVN1QS.js";const ye={class:"vietqr-payment"},we={key:0,class:"text-center py-12"},ke={key:1,class:"space-y-6"},_e={class:"bg-blue-500/10 border border-blue-500/30 rounded-lg overflow-hidden"},$e={class:"flex items-center gap-2"},Ce={class:"text-xs text-blue-300/60"},Se={class:"border-t border-blue-500/20"},Me={class:"bg-white p-6 rounded-2xl mx-auto max-w-sm"},Pe=["src"],Ie={class:"bg-gray-800/50 rounded-xl p-6 border border-gray-700 space-y-4"},Te={class:"flex justify-between items-center pb-4 border-b border-gray-700"},Re={class:"text-2xl font-bold text-red-500"},je={class:"space-y-2"},Be={class:"flex justify-between"},ze={class:"text-white font-medium"},Ne={class:"flex justify-between"},Ee={class:"text-white font-mono"},Ve={class:"flex justify-between"},Qe={class:"text-white"},De={class:"bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4"},He={class:"flex items-start gap-3"},Ue={class:"flex-1"},Ae={class:"flex items-center gap-2"},Le={class:"text-white font-mono text-lg bg-gray-900 px-3 py-1 rounded"},Oe=["title"],qe={key:0,class:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Fe={key:1,class:"w-5 h-5 text-green-400",fill:"currentColor",viewBox:"0 0 20 20"},Ge={class:"bg-gradient-to-r from-red-900/50 to-orange-900/50 border border-red-500/30 rounded-xl p-4"},Ke={class:"flex items-center justify-between"},Je={class:"text-right"},Xe={key:0,class:"bg-blue-900/30 border border-blue-500/30 rounded-xl p-6 text-center"},Ye={key:0,class:"mt-4 p-3 bg-gray-800 rounded text-xs text-left"},We={class:"text-gray-300"},Ze={class:"text-gray-300"},et={class:"text-gray-300"},tt={class:"text-gray-300"},st=["disabled"],ot={key:1,class:"bg-green-900/30 border border-green-500/30 rounded-xl p-6 text-center animate-fade-in"},nt={key:2,class:"text-center py-12"},at={class:"text-red-400 font-bold mb-2"},lt={__name:"VietQRPayment",props:{orderId:{type:Number,required:!0}},emits:["success","retry","expired"],setup(x,{emit:z}){const b=X(),$=x,m=z,y=c(!0),g=c(null),w=c(null),p=c(!1),C=c(!1),M=c(900),R=c(!1),j=c(!1),h=c(null),v=c(!1);let N=null,I=null;const E=(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="::1")&&window.loc,B="http://localhost/HTHREE_film/backend/api";te(async()=>{await A(),Q(),L()}),ue(()=>{S(),T()});const A=async()=>{y.value=!0,w.value=null;try{const t=await(await fetch(`${B}/payment/generate_vietqr.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:$.orderId})})).json();if(t.success)g.value=t.data,M.value=t.data.timeout_seconds;else throw new Error(t.message)}catch(o){w.value=o.message||"Kh√¥ng th·ªÉ t·∫°o m√£ QR",b.error(w.value)}finally{y.value=!1}},Q=()=>{p.value=!0,N=setInterval(async()=>{try{if(E)try{const k=await(await fetch(`${B}/payment/debug_order.php?order_id=${$.orderId}`)).json();k.success&&(h.value=k)}catch(d){console.log("Debug failed:",d)}const t=await(await fetch(`${B}/payment/check_payment_status.php?order_id=${$.orderId}`)).json();if(t.success&&t.data.paid){C.value=!0,p.value=!1,S(),T(),b.success("üéâ Thanh to√°n th√†nh c√¥ng!"),setTimeout(()=>{m("success")},2e3);return}if(t.success&&t.data.expired){S(),T(),m("expired");return}if(E&&g.value&&g.value.order_code)try{(await(await fetch(`${B}/payment/simulate_bank_transfer.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_code:g.value.order_code,amount:g.value.amount})})).json()).success&&(C.value=!0,p.value=!1,S(),T(),b.success("üéâ Ph√°t hi·ªán chuy·ªÉn kho·∫£n th√†nh c√¥ng!"),setTimeout(()=>{m("success")},2e3))}catch(d){console.log("Bank simulation check failed (normal):",d.message)}}catch(o){console.error("Error checking payment:",o)}},2e3)},S=()=>{N&&(clearInterval(N),N=null)},L=()=>{I=setInterval(()=>{M.value--,M.value<=0&&(T(),S(),m("expired"))},1e3)},T=()=>{I&&(clearInterval(I),I=null)},O=o=>{const t=Math.floor(o/60),d=o%60;return`${t.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`},u=o=>new Intl.NumberFormat("vi-VN").format(o)+"ƒë",a=async()=>{try{await navigator.clipboard.writeText(g.value.transfer_content),R.value=!0,b.success("ƒê√£ copy n·ªôi dung chuy·ªÉn kho·∫£n"),setTimeout(()=>{R.value=!1},2e3)}catch{b.error("Kh√¥ng th·ªÉ copy")}},s=o=>{o.target.src="https://placehold.co/400x400/1a1a1a/fff?text=QR+Error",w.value="Kh√¥ng th·ªÉ t·∫£i m√£ QR"},n=async()=>{if(!v.value){v.value=!0;try{const t=await(await fetch(`${B}/payment/manual_test_payment.php`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:$.orderId})})).json();if(t.success)C.value=!0,p.value=!1,S(),T(),b.success("üéâ Test payment th√†nh c√¥ng!"),setTimeout(()=>{m("success")},1500);else throw new Error(t.message)}catch(o){b.error("Test payment failed: "+o.message)}finally{v.value=!1}}};return(o,t)=>{var d,k,D,P;return l(),i("div",ye,[y.value?(l(),i("div",we,t[3]||(t[3]=[e("div",{class:"animate-spin h-12 w-12 border-4 border-yellow-400 rounded-full border-t-transparent mx-auto mb-4"},null,-1),e("p",{class:"text-white"},"ƒêang t·∫°o m√£ QR...",-1)]))):g.value?(l(),i("div",ke,[t[25]||(t[25]=e("div",{class:"text-center"},[e("h3",{class:"text-2xl font-bold text-white mb-2"}," Qu√©t m√£ QR ƒë·ªÉ thanh to√°n "),e("p",{class:"text-gray-400"},"S·ª≠ d·ª•ng app ng√¢n h√†ng ƒë·ªÉ qu√©t m√£ QR")],-1)),e("div",_e,[e("button",{onClick:t[0]||(t[0]=V=>j.value=!j.value),class:"w-full p-4 flex items-center justify-between hover:bg-blue-500/5 transition-colors duration-200"},[e("div",$e,[t[4]||(t[4]=e("svg",{class:"w-5 h-5 text-blue-400",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t[5]||(t[5]=e("h4",{class:"text-blue-400 font-bold"},"H∆∞·ªõng d·∫´n chuy·ªÉn kho·∫£n",-1)),e("span",Ce,"(Click ƒë·ªÉ "+r(j.value?"·∫©n":"xem")+")",1)]),(l(),i("svg",{class:_(["w-5 h-5 text-blue-400 transition-transform duration-200 ease-out",{"rotate-180":j.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)]),2))]),J(oe,{"enter-active-class":"transition-all duration-200 ease-out origin-top","enter-from-class":"opacity-0 scale-y-0","enter-to-class":"opacity-100 scale-y-100","leave-active-class":"transition-all duration-150 ease-in origin-top","leave-from-class":"opacity-100 scale-y-100","leave-to-class":"opacity-0 scale-y-0"},{default:se(()=>[H(e("div",Se,t[7]||(t[7]=[e("div",{class:"px-4 py-4 space-y-3 text-sm text-gray-300"},[e("div",{class:"flex items-start gap-2"},[e("span",{class:"text-blue-400 font-bold"},"üì± B∆∞·ªõc 1:"),e("span",null,"M·ªü app ng√¢n h√†ng c·ªßa b·∫°n")]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"text-blue-400 font-bold"},"üì∏ B∆∞·ªõc 2:"),e("span",null,"Qu√©t m√£ QR b√™n d∆∞·ªõi")]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"text-blue-400 font-bold"},"‚úçÔ∏è B∆∞·ªõc 3:"),e("span",null,"Ki·ªÉm tra n·ªôi dung chuy·ªÉn kho·∫£n (t·ª± ƒë·ªông ƒëi·ªÅn)")]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"text-blue-400 font-bold"},"‚úÖ B∆∞·ªõc 4:"),e("span",null,"X√°c nh·∫≠n chuy·ªÉn kho·∫£n")]),e("div",{class:"flex items-start gap-2"},[e("span",{class:"text-blue-400 font-bold"},"‚ö° B∆∞·ªõc 5:"),e("span",null,"G√≥i s·∫Ω t·ª± ƒë·ªông k√≠ch ho·∫°t ngay khi chuy·ªÉn kho·∫£n th√†nh c√¥ng")])],-1)]),512),[[ce,j.value]])]),_:1})]),e("div",Me,[e("img",{src:g.value.qr_url,alt:"VietQR Code",class:"w-full h-auto",onError:s},null,40,Pe)]),e("div",Ie,[e("div",Te,[t[8]||(t[8]=e("span",{class:"text-gray-400"},"S·ªë ti·ªÅn",-1)),e("span",Re,r(u(g.value.amount)),1)]),e("div",je,[e("div",Be,[t[9]||(t[9]=e("span",{class:"text-gray-400"},"Ng√¢n h√†ng",-1)),e("span",ze,r(g.value.bank_name),1)]),e("div",Ne,[t[10]||(t[10]=e("span",{class:"text-gray-400"},"S·ªë t√†i kho·∫£n",-1)),e("span",Ee,r(g.value.account_no),1)]),e("div",Ve,[t[11]||(t[11]=e("span",{class:"text-gray-400"},"Ch·ªß t√†i kho·∫£n",-1)),e("span",Qe,r(g.value.account_name),1)])]),e("div",De,[e("div",He,[t[16]||(t[16]=e("svg",{class:"w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),e("div",Ue,[t[14]||(t[14]=e("p",{class:"text-yellow-400 font-bold text-sm mb-1"}," N·ªôi dung chuy·ªÉn kho·∫£n ",-1)),e("div",Ae,[e("code",Le,r(g.value.transfer_content),1),e("button",{onClick:a,class:"p-2 hover:bg-gray-700 rounded transition-colors",title:R.value?"ƒê√£ copy!":"Copy n·ªôi dung"},[R.value?(l(),i("svg",Fe,t[13]||(t[13]=[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},null,-1)]))):(l(),i("svg",qe,t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])))],8,Oe)]),t[15]||(t[15]=e("p",{class:"text-yellow-300 text-xs mt-2"}," ‚ö†Ô∏è Vui l√≤ng nh·∫≠p ch√≠nh x√°c n·ªôi dung ƒë·ªÉ h·ªá th·ªëng t·ª± ƒë·ªông k√≠ch ho·∫°t g√≥i ",-1))])])])]),e("div",Ge,[e("div",Ke,[t[17]||(t[17]=Y('<div class="flex items-center gap-3" data-v-23790572><svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-23790572><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" data-v-23790572></path></svg><div data-v-23790572><p class="text-white font-bold" data-v-23790572>Th·ªùi gian c√≤n l·∫°i</p><p class="text-gray-400 text-sm" data-v-23790572> ƒê∆°n h√†ng s·∫Ω t·ª± ƒë·ªông h·ªßy sau khi h·∫øt th·ªùi gian </p></div></div>',1)),e("div",Je,[e("p",{class:_(["text-3xl font-mono font-bold",M.value<60?"text-red-400 animate-pulse":"text-white"])},r(O(M.value)),3)])])]),p.value?(l(),i("div",Xe,[t[19]||(t[19]=e("div",{class:"animate-spin h-8 w-8 border-3 border-blue-400 rounded-full border-t-transparent mx-auto mb-3"},null,-1)),t[20]||(t[20]=e("p",{class:"text-blue-400 font-bold mb-1"},"ƒêang ki·ªÉm tra thanh to√°n...",-1)),t[21]||(t[21]=e("p",{class:"text-gray-400 text-sm"}," H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông k√≠ch ho·∫°t g√≥i sau khi nh·∫≠n ƒë∆∞·ª£c ti·ªÅn ",-1)),ge(E)&&h.value?(l(),i("div",Ye,[t[18]||(t[18]=e("p",{class:"text-yellow-400 font-bold mb-2"},"üêõ Debug Info:",-1)),e("p",We,"Order ID: "+r((d=h.value.order)==null?void 0:d.id),1),e("p",Ze,"Status: "+r((k=h.value.order)==null?void 0:k.payment_status),1),e("p",et,"Created: "+r((D=h.value.timing)==null?void 0:D.created_seconds_ago)+"s ago",1),e("p",tt,"Simulation Ready: "+r((P=h.value.timing)!=null&&P.simulation_ready?"Yes":"No")+" (5s delay)",1),C.value?f("",!0):(l(),i("button",{key:0,onClick:n,disabled:v.value,class:"mt-2 px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-xs rounded disabled:opacity-50"},r(v.value?"ƒêang test...":"‚ö° Test Payment Ngay"),9,st))])):f("",!0)])):f("",!0),C.value?(l(),i("div",ot,[t[22]||(t[22]=e("svg",{class:"w-16 h-16 text-green-400 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),t[23]||(t[23]=e("h3",{class:"text-2xl font-bold text-green-400 mb-2"}," Thanh to√°n th√†nh c√¥ng! ",-1)),t[24]||(t[24]=e("p",{class:"text-gray-300 mb-4"},"G√≥i c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t",-1)),e("button",{onClick:t[1]||(t[1]=V=>o.$emit("success")),class:"bg-green-500 hover:bg-green-600 text-white font-bold px-6 py-3 rounded-lg transition-colors"}," Xem t√†i kho·∫£n ")])):f("",!0),t[26]||(t[26]=Y('<div class="bg-gray-800/30 rounded-xl p-6 border border-gray-700" data-v-23790572><h4 class="text-white font-bold mb-3 flex items-center gap-2" data-v-23790572><svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20" data-v-23790572><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-23790572></path></svg> H∆∞·ªõng d·∫´n thanh to√°n </h4><ol class="space-y-2 text-gray-300 text-sm" data-v-23790572><li class="flex gap-2" data-v-23790572><span class="text-yellow-400 font-bold" data-v-23790572>1.</span><span data-v-23790572>M·ªü app ng√¢n h√†ng c·ªßa b·∫°n</span></li><li class="flex gap-2" data-v-23790572><span class="text-yellow-400 font-bold" data-v-23790572>2.</span><span data-v-23790572>Ch·ªçn &quot;Qu√©t m√£ QR&quot; ho·∫∑c &quot;Chuy·ªÉn kho·∫£n&quot;</span></li><li class="flex gap-2" data-v-23790572><span class="text-yellow-400 font-bold" data-v-23790572>3.</span><span data-v-23790572>Qu√©t m√£ QR ph√≠a tr√™n</span></li><li class="flex gap-2" data-v-23790572><span class="text-yellow-400 font-bold" data-v-23790572>4.</span><span data-v-23790572>Ki·ªÉm tra th√¥ng tin v√† x√°c nh·∫≠n chuy·ªÉn kho·∫£n</span></li><li class="flex gap-2" data-v-23790572><span class="text-yellow-400 font-bold" data-v-23790572>5.</span><span data-v-23790572>G√≥i s·∫Ω t·ª± ƒë·ªông k√≠ch ho·∫°t ngay khi chuy·ªÉn kho·∫£n th√†nh c√¥ng</span></li></ol></div>',1))])):w.value?(l(),i("div",nt,[t[27]||(t[27]=e("svg",{class:"w-16 h-16 text-red-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",at,r(w.value),1),e("button",{onClick:t[2]||(t[2]=V=>o.$emit("retry")),class:"bg-gray-700 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors"}," Th·ª≠ l·∫°i ")])):f("",!0)])}}},rt=G(lt,[["__scopeId","data-v-23790572"]]),it={class:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in"},dt={class:"relative bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto border-2 border-gray-700 shadow-2xl animate-scale-in"},ut={class:"p-8"},ct={class:"text-center mb-8"},gt={class:"text-3xl font-black text-white mb-2"},pt={class:"text-gray-400"},ht={class:"mb-6"},mt={class:"space-y-3"},vt={class:"flex items-center gap-4"},bt=["value"],ft={class:"text-white font-bold"},xt={key:0,class:"text-green-400 text-sm"},yt={class:"text-right"},wt={class:"text-white font-bold text-xl"},kt={key:0,class:"text-gray-500 text-sm line-through"},_t={class:"bg-gradient-to-r from-red-900/30 to-orange-900/30 rounded-xl p-6 mb-6 border border-red-500/30"},$t={class:"flex justify-between items-center"},Ct={class:"text-3xl font-black text-red-400"},St={class:"grid grid-cols-2 gap-4"},Mt={class:"space-y-2"},Pt=["value"],It={class:"flex-1"},Tt={class:"text-white font-bold text-sm"},Rt={class:"text-gray-400 text-xs"},jt=["disabled"],Bt={__name:"PaymentModal",props:{plan:{type:Object,required:!0}},emits:["close","success"],setup(x,{emit:z}){const b=X(),$=ne(),m=x,y=z,g=ae(),w=c(1),p=c(!1),C=c(null),M=c(!1),R=[{months:1,label:"1 th√°ng",discount:0},{months:3,label:"3 th√°ng",discount:5},{months:6,label:"6 th√°ng",discount:10},{months:12,label:"12 th√°ng",discount:15}],h=(()=>{var n,o,t;const u=localStorage.getItem("user"),a=localStorage.getItem("userPhoneNumber");let s={};if(u)try{s=JSON.parse(u)}catch(d){console.error("Error parsing user data:",d)}return{name:s.full_name||s.displayName||((n=g.user)==null?void 0:n.full_name)||((o=g.user)==null?void 0:o.displayName)||"",email:s.email||((t=g.user)==null?void 0:t.email)||"",phone:a||s.phone||s.phone_number||""}})(),v=c({name:h.name,email:h.email,phone:h.phone,paymentMethod:"bank_transfer"}),N=[{value:"vietqr",label:"VietQR - Chuy·ªÉn kho·∫£n ng√¢n h√†ng",description:"Qu√©t m√£ QR, t·ª± ƒë·ªông k√≠ch ho·∫°t ngay khi chuy·ªÉn kho·∫£n th√†nh c√¥ng"},{value:"bank_transfer",label:"Chuy·ªÉn kho·∫£n th·ªß c√¥ng",description:"Chuy·ªÉn kho·∫£n v√† ch·ªù admin duy·ªát"}],I=le(()=>{const u=R.find(a=>a.months===w.value);return E(m.plan.price,w.value,(u==null?void 0:u.discount)||0)}),E=(u,a,s)=>{const n=u*a,o=n*(s/100);return Math.round(n-o)},B=async()=>{var u,a,s,n;p.value=!0;try{const o=localStorage.getItem("user");let t=null;if(o)try{t=JSON.parse(o).id}catch(V){console.error("Error parsing user data:",V)}t||(t=((u=g.user)==null?void 0:u.id)||((a=g.user)==null?void 0:a.uid)),console.log("Creating order with user_id:",t,"plan_id:",m.plan.id);const d={user_id:t,customer_name:v.value.name,customer_email:v.value.email,customer_phone:v.value.phone,payment_method:v.value.paymentMethod,plan_id:m.plan.id,duration_months:w.value,total_price:I.value},P=await(await fetch("http://localhost/HTHREE_film/backend/api/demo/buy_plan_demo.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({plan_slug:m.plan.slug})})).json();P.success?(C.value=P.data.order_id,b.success(`G√≥i ${m.plan.name} ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t! (${P.data.duration_minutes} ph√∫t)`),setTimeout(()=>{y("success"),$.push("/account")},1500)):b.error(P.message||"Kh√¥ng th·ªÉ t·∫°o g√≥i")}catch(o){b.error(((n=(s=o.response)==null?void 0:s.data)==null?void 0:n.message)||"Kh√¥ng th·ªÉ t·∫°o ƒë∆°n h√†ng")}finally{p.value=!1}},A=()=>{b.success("Thanh to√°n th√†nh c√¥ng! G√≥i ƒë√£ ƒë∆∞·ª£c k√≠ch ho·∫°t"),y("success"),y("close"),$.push("/account")},Q=()=>{b.error("ƒê∆°n h√†ng ƒë√£ h·∫øt h·∫°n. Vui l√≤ng t·∫°o ƒë∆°n m·ªõi"),M.value=!1,C.value=null},S=u=>new Intl.NumberFormat("vi-VN").format(u)+"ƒë",L=u=>({free:"üé¨",basic:"‚≠ê",premium:"üî•",vip:"üëë"})[u]||"üé¨",T=u=>{const a={free:"bg-gradient-to-br from-gray-700 to-gray-600",basic:"bg-gradient-to-br from-blue-600 to-cyan-500",premium:"bg-gradient-to-br from-red-600 to-yellow-500",vip:"bg-gradient-to-br from-purple-600 to-pink-500"};return a[u]||a.free},O=u=>{const a={free:"bg-gray-700 text-white hover:bg-gray-600",basic:"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-lg shadow-blue-500/50 hover:shadow-blue-500/70",premium:"bg-gradient-to-r from-red-600 to-yellow-500 text-white shadow-lg shadow-red-500/50 hover:shadow-red-500/70",vip:"bg-gradient-to-r from-purple-600 to-pink-500 text-white shadow-lg shadow-purple-500/50 hover:shadow-purple-500/70"};return a[u]||a.free};return(u,a)=>(l(),q(pe,{to:"body"},[e("div",it,[e("div",{class:"absolute inset-0 bg-black/80 backdrop-blur-sm",onClick:a[0]||(a[0]=s=>u.$emit("close"))}),e("div",dt,[e("button",{onClick:a[1]||(a[1]=s=>u.$emit("close")),class:"absolute top-4 right-4 w-10 h-10 rounded-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center transition-colors z-10"},a[8]||(a[8]=[e("svg",{class:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])),e("div",ut,[e("div",ct,[e("div",{class:_(["w-20 h-20 mx-auto mb-4 rounded-2xl flex items-center justify-center text-4xl",T(x.plan.slug)])},r(L(x.plan.slug)),3),e("h2",gt," Thanh to√°n g√≥i "+r(x.plan.name),1),e("p",pt,r(x.plan.description),1)]),e("div",ht,[a[9]||(a[9]=e("label",{class:"block text-white font-bold text-lg mb-4"},"Ch·ªçn th·ªùi gian:",-1)),e("div",mt,[(l(),i(U,null,F(R,s=>e("label",{key:s.months,class:_(["flex items-center justify-between p-4 bg-gray-800/50 rounded-xl cursor-pointer border-2 transition-all hover:bg-gray-800",w.value===s.months?"border-red-500 bg-red-500/10":"border-transparent"])},[e("div",vt,[H(e("input",{type:"radio",value:s.months,"onUpdate:modelValue":a[2]||(a[2]=n=>w.value=n),class:"w-5 h-5 text-red-600"},null,8,bt),[[W,w.value]]),e("div",null,[e("p",ft,r(s.label),1),s.discount>0?(l(),i("p",xt," Ti·∫øt ki·ªám "+r(s.discount)+"% üéâ ",1)):f("",!0)])]),e("div",yt,[e("p",wt,r(S(E(x.plan.price,s.months,s.discount))),1),s.months>1?(l(),i("p",kt,r(S(x.plan.price*s.months)),1)):f("",!0)])],2)),64))])]),e("div",_t,[e("div",$t,[a[10]||(a[10]=e("span",{class:"text-xl font-bold text-white"},"T·ªïng thanh to√°n",-1)),e("span",Ct,r(S(I.value)),1)])]),e("form",{onSubmit:re(B,["prevent"]),class:"space-y-4"},[e("div",St,[e("div",null,[a[11]||(a[11]=e("label",{class:"block text-gray-400 text-sm mb-2"},"H·ªç t√™n *",-1)),H(e("input",{"onUpdate:modelValue":a[3]||(a[3]=s=>v.value.name=s),type:"text",required:"",class:"w-full bg-gray-800 text-white px-4 py-3 rounded-lg border border-gray-700 focus:border-red-600 focus:outline-none transition-colors",placeholder:"Nguy·ªÖn VƒÉn A"},null,512),[[K,v.value.name]])]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-gray-400 text-sm mb-2"},"S·ªë ƒëi·ªán tho·∫°i",-1)),H(e("input",{"onUpdate:modelValue":a[4]||(a[4]=s=>v.value.phone=s),type:"tel",class:"w-full bg-gray-800 text-white px-4 py-3 rounded-lg border border-gray-700 focus:border-red-600 focus:outline-none transition-colors",placeholder:"0901234567"},null,512),[[K,v.value.phone]])])]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-gray-400 text-sm mb-2"},"Email *",-1)),H(e("input",{"onUpdate:modelValue":a[5]||(a[5]=s=>v.value.email=s),type:"email",required:"",class:"w-full bg-gray-800 text-white px-4 py-3 rounded-lg border border-gray-700 focus:border-red-600 focus:outline-none transition-colors",placeholder:"email@example.com"},null,512),[[K,v.value.email]])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-gray-400 text-sm mb-3"},"Ph∆∞∆°ng th·ª©c thanh to√°n *",-1)),e("div",Mt,[(l(),i(U,null,F(N,s=>e("label",{key:s.value,class:_(["flex items-center gap-3 p-3 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition-colors border-2",v.value.paymentMethod===s.value?"border-red-600 bg-red-600/10":"border-transparent"])},[H(e("input",{"onUpdate:modelValue":a[6]||(a[6]=n=>v.value.paymentMethod=n),type:"radio",value:s.value,class:"w-4 h-4 text-red-600"},null,8,Pt),[[W,v.value.paymentMethod]]),e("div",It,[e("p",Tt,r(s.label),1),e("p",Rt,r(s.description),1)])],2)),64))])]),M.value?f("",!0):(l(),i("button",{key:0,type:"submit",disabled:p.value,class:_(["w-full py-4 rounded-xl font-bold text-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",O(x.plan.slug)])},[p.value?(l(),i(U,{key:0},[a[15]||(a[15]=e("svg",{class:"animate-spin h-5 w-5",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),a[16]||(a[16]=e("span",null,"ƒêang x·ª≠ l√Ω...",-1))],64)):(l(),i(U,{key:1},[a[17]||(a[17]=e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("span",null,r(v.value.paymentMethod==="vietqr"?"T·∫°o m√£ QR":"X√°c nh·∫≠n thanh to√°n")+" "+r(S(I.value)),1)],64))],10,jt))],32),M.value&&C.value?(l(),q(rt,{key:0,"order-id":C.value,onSuccess:A,onExpired:Q,onRetry:a[7]||(a[7]=s=>M.value=!1)},null,8,["order-id"])):f("",!0)])])])]))}},zt=G(Bt,[["__scopeId","data-v-f5f903fe"]]),Nt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none"},Et={class:"relative"},Vt={key:0,class:"absolute top-full mt-4 left-1/2 -translate-x-1/2 whitespace-nowrap"},Qt={class:"text-white font-bold text-lg bg-gray-900/90 px-6 py-2 rounded-full shadow-xl animate-slide-up"},Dt={__name:"SuccessAnimation",props:{show:{type:Boolean,default:!1},message:{type:String,default:""},duration:{type:Number,default:2e3}},emits:["close"],setup(x,{emit:z}){const b=x,$=z;return he(()=>b.show,m=>{m&&setTimeout(()=>{$("close")},b.duration)}),(m,y)=>(l(),q(oe,{name:"success-fade"},{default:se(()=>[x.show?(l(),i("div",Nt,[e("div",Et,[y[0]||(y[0]=e("div",{class:"absolute inset-0 flex items-center justify-center"},[e("div",{class:"w-32 h-32 rounded-full bg-green-500/20 animate-ping"})],-1)),y[1]||(y[1]=e("div",{class:"relative w-24 h-24 rounded-full bg-green-500 flex items-center justify-center shadow-2xl animate-scale-bounce"},[e("svg",{class:"w-12 h-12 text-white animate-draw-check",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7",class:"checkmark-path"})])],-1)),x.message?(l(),i("div",Vt,[e("p",Qt,r(x.message),1)])):f("",!0)])])):f("",!0)]),_:1}))}},Ht=G(Dt,[["__scopeId","data-v-29c967c2"]]),Ut={class:"min-h-screen bg-black relative overflow-hidden"},At={class:"relative z-10 container mx-auto px-4 py-20"},Lt={class:"text-center mb-16 animate-fade-in"},Ot={class:"text-6xl font-black text-white mb-4"},qt={class:"text-red-600"},Ft={class:"text-xl text-gray-400"},Gt={key:0,class:"text-center py-20"},Kt={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-[1400px] mx-auto"},Jt=["onMouseenter"],Xt={key:0,class:"absolute -top-3 left-1/2 -translate-x-1/2 z-10"},Yt={key:1,class:"absolute -top-3 left-1/2 -translate-x-1/2"},Wt={class:"bg-gradient-to-r from-green-600 to-red-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase shadow-lg animate-pulse"},Zt={key:2,class:"absolute -top-3 left-1/2 -translate-x-1/2"},es={class:"bg-gradient-to-r from-red-600 to-yellow-500 text-white px-4 py-1 rounded-full text-xs font-bold uppercase shadow-lg"},ts={class:"mb-6 relative"},ss={key:0,class:"absolute -top-2 -right-2 bg-white text-black text-xs font-bold px-2 py-1 rounded-full shadow-lg"},os={class:"mb-6"},ns={class:"flex items-baseline gap-2"},as={key:0,class:"text-gray-400"},ls={key:0,class:"text-green-400 font-bold text-sm mt-2"},rs={key:1,class:"text-gray-400 text-sm mt-2"},is={class:"space-y-3 mb-8"},ds={key:0,"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"},us={key:1,"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"},cs={class:"text-sm"},gs=["onClick"],ps={key:0,class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-shine"},hs={class:"relative z-10"},ms={key:3,class:"mt-4 text-center text-yellow-400 text-sm font-bold animate-pulse"},vs={__name:"Pricing",setup(x){const z=ne(),b=ae();fe();const $=X(),m=c([]),y=c(!1),g=c(!1),w=c(null),p=c(null);c("monthly");const C=c(!1),M=c(""),R=c({}),j=c(null),{t:h}=me(),v=[{label:h("common.home"),to:"/home"},{label:h("pricing.title"),to:"/pricing"}];le(()=>{const s=["free","basic","christmas","premium","vip"];return[...m.value].sort((n,o)=>{const t=s.indexOf(n.slug),d=s.indexOf(o.slug);return(t===-1?999:t)-(d===-1?999:d)})}),te(async()=>{m.value=[],await I(),await N()});const N=async()=>{const s=localStorage.getItem("user");if(s)try{const o=JSON.parse(s).id,k=await(await fetch(`http://localhost/HTHREE_film/backend/api/user_subscription.php?user_id=${o}`)).json();if(k.success&&k.data&&k.data.length>0){const D=k.data.filter(P=>P.status==="active");if(D.length>0){const P={vip:4,premium:3,basic:2,free:1},V=D.sort((ie,de)=>(P[de.plan_slug]||0)-(P[ie.plan_slug]||0))[0];j.value=V.plan_slug}}}catch(n){console.error("Failed to fetch user plan:",n)}},I=async()=>{y.value=!0;try{const s=await xe(!0);console.log("üì¶ Fetched plans:",s),s.success&&(m.value=s.data,console.log("‚úÖ Plans loaded:",m.value.length,"plans"),console.log("üéÑ Christmas plan:",m.value.find(n=>n.slug==="christmas")),m.value.forEach(n=>{R.value[n.id]=1}))}catch(s){console.error("‚ùå Error fetching plans:",s);const{handleError:n}=await ve(async()=>{const{handleError:t}=await import("./useErrorHandler-svuVN1QS.js").then(d=>d.u);return{handleError:t}},[],import.meta.url);n().handleError(s,{context:"Fetch Plans",fallbackMessage:"Kh√¥ng th·ªÉ t·∫£i danh s√°ch g√≥i. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi Internet v√† th·ª≠ l·∫°i."})}finally{y.value=!1}},E=(s,n,o)=>{const t=s*n,d=t*(o/100);return Math.round(t-d)},B=s=>{if(!b.user){$.warning(h("pricing.loginToBuy")),z.push("/account");return}if(s.slug==="free"){$.info(h("pricing.usingFreePlan"));return}w.value=s,g.value=!0},A=()=>{g.value=!1,$.success(h("pricing.paymentSuccess")),z.push("/account")},Q=s=>s===0?h("pricing.free"):new Intl.NumberFormat("vi-VN").format(s)+"ƒë",S=s=>{const n=[{text:s.has_ads?h("pricing.hasAds"):h("pricing.noAds"),checked:!s.has_ads,iconClass:s.has_ads?"text-red-500":"text-green-500"},{text:h("pricing.devices",{count:s.max_devices}),checked:!0,iconClass:"text-green-500"},{text:s.can_download?h("pricing.canDownload"):h("pricing.noDownload"),checked:s.can_download,iconClass:s.can_download?"text-green-500":"text-gray-500"}];return s.early_access&&n.push({text:h("pricing.earlyAccess"),checked:!0,iconClass:"text-yellow-500"}),n},L=s=>({free:"üé¨",basic:"‚≠ê",premium:"üî•",vip:"üëë",christmas:"üéÑ"})[s]||"üé¨",T=s=>{const n={free:"bg-gradient-to-r from-gray-600 to-gray-400",basic:"bg-gradient-to-r from-blue-600 to-cyan-500",premium:"bg-gradient-to-r from-red-600 to-yellow-500",vip:"bg-gradient-to-r from-purple-600 to-pink-500",christmas:"bg-gradient-to-r from-green-600 via-red-500 to-green-600"};return n[s]||n.free},O=s=>{const n={free:"bg-gradient-to-br from-gray-700 to-gray-600",basic:"bg-gradient-to-br from-blue-600 to-cyan-500",premium:"bg-gradient-to-br from-red-600 to-yellow-500",vip:"bg-gradient-to-br from-purple-600 to-pink-500",christmas:"bg-gradient-to-br from-green-600 to-red-600"};return n[s]||n.free},u=s=>{const n={free:"bg-gray-700 text-gray-300",basic:"bg-blue-600/20 text-blue-400 border border-blue-500/50",premium:"bg-red-600/20 text-red-400 border border-red-500/50",vip:"bg-purple-600/20 text-purple-400 border border-purple-500/50",christmas:"bg-green-600/20 text-green-400 border border-green-500/50"};return n[s]||n.free},a=s=>{const n={free:"bg-gray-700 text-white",basic:"bg-gradient-to-r from-blue-600 to-cyan-500 text-white shadow-lg shadow-blue-500/50",premium:"bg-gradient-to-r from-red-600 to-yellow-500 text-white shadow-lg shadow-red-500/50",vip:"bg-gradient-to-r from-purple-600 to-pink-500 text-white shadow-lg shadow-purple-500/50",christmas:"bg-gradient-to-r from-green-600 to-red-600 text-white shadow-lg shadow-green-500/50"};return n[s]||n.free};return(s,n)=>(l(),i("div",Ut,[J(Ht,{show:C.value,message:M.value,onClose:n[0]||(n[0]=o=>C.value=!1)},null,8,["show","message"]),n[6]||(n[6]=e("div",{class:"absolute inset-0"},[e("div",{class:"absolute top-0 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-3xl animate-pulse"}),e("div",{class:"absolute bottom-0 right-1/4 w-96 h-96 bg-yellow-600/10 rounded-full blur-3xl animate-pulse",style:{"animation-delay":"1s"}})],-1)),e("div",At,[J(be,{items:v,class:"mb-8"}),e("div",Lt,[e("h1",Ot,[Z(r(s.$t("pricing.chooseTitle"))+" ",1),e("span",qt,r(s.$t("pricing.chooseTitleHighlight")),1),Z(" "+r(s.$t("pricing.chooseTitleEnd")),1)]),e("p",Ft,r(s.$t("pricing.subtitle")),1)]),y.value?(l(),i("div",Gt,n[3]||(n[3]=[e("div",{class:"inline-block animate-spin rounded-full h-16 w-16 border-4 border-t-red-600 border-r-transparent border-b-red-600 border-l-transparent"},null,-1)]))):(l(),i("div",Kt,[(l(!0),i(U,null,F(m.value,(o,t)=>(l(),i("div",{key:o.id,onMouseenter:d=>p.value=o.slug,onMouseleave:n[1]||(n[1]=d=>p.value=null),class:_(["group relative bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-6 border-2 transition-all duration-300 animate-slide-up",[o.slug==="christmas"?"border-green-600/50 lg:scale-105 shadow-lg shadow-green-600/20":o.slug==="premium"?"border-red-600/50 lg:scale-105 shadow-lg shadow-red-600/10":"border-gray-700/50 hover:border-gray-600",p.value===o.slug?"scale-102 shadow-2xl":""]]),style:ee({animationDelay:`${t*.1}s`})},[e("div",{class:_(["absolute -inset-0.5 rounded-2xl opacity-0 transition-opacity duration-300 blur-lg -z-10",[T(o.slug),p.value===o.slug?"opacity-20":""]])},null,2),j.value===o.slug?(l(),i("div",Xt,n[4]||(n[4]=[e("span",{class:"bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase shadow-lg"}," ‚úì ƒêang s·ª≠ d·ª•ng ",-1)]))):o.promotion_badge?(l(),i("div",Yt,[e("span",Wt,r(o.promotion_badge),1)])):o.slug==="premium"?(l(),i("div",Zt,[e("span",es," ‚≠ê "+r(s.$t("pricing.mostPopular")),1)])):f("",!0),e("div",ts,[e("div",{class:_(["w-20 h-20 rounded-2xl flex items-center justify-center text-4xl shadow-lg transform transition-all duration-300",[O(o.slug),p.value===o.slug?"scale-110 rotate-3":""]])},r(L(o.slug)),3),p.value===o.slug?(l(),i("div",ss,r(s.$t("pricing.clickToSelect")),1)):f("",!0)]),e("h3",{class:_(["text-3xl font-black mb-2 transition-all duration-300",p.value===o.slug?"text-red-500 scale-105":"text-white"])},r(o.name),3),e("div",{class:_(["inline-block px-3 py-1 rounded-full text-xs font-bold mb-6",u(o.slug)])},r(o.quality),3),e("div",os,[e("div",ns,[e("span",{class:_(["text-5xl font-black text-white transition-all duration-300",p.value===o.slug?"scale-110":""])},r(o.slug==="free"?s.$t("pricing.free"):Q(o.price)),3),o.slug!=="free"?(l(),i("span",as,"/th√°ng")):f("",!0)]),o.promotion_text?(l(),i("p",ls," üéÅ "+r(o.promotion_text),1)):o.price>0?(l(),i("p",rs," Ho·∫∑c "+r(Q(E(o.price,12,15)))+"/nƒÉm (ti·∫øt ki·ªám 15%) ",1)):f("",!0)]),e("ul",is,[(l(!0),i(U,null,F(S(o),(d,k)=>(l(),i("li",{key:k,class:_(["flex items-center gap-2 text-gray-300 transition-all duration-300",p.value===o.slug?"translate-x-1":""]),style:ee({transitionDelay:p.value===o.slug?`${k*50}ms`:"0ms"})},[(l(),i("svg",{class:_(["w-5 h-5 flex-shrink-0",d.iconClass]),fill:"currentColor",viewBox:"0 0 20 20"},[d.checked?(l(),i("path",ds)):(l(),i("path",us))],2)),e("span",cs,r(d.text),1)],6))),128))]),e("button",{onClick:re(d=>B(o),["stop"]),class:_(["relative w-full py-4 rounded-xl font-bold text-center transition-all duration-300 overflow-hidden flex items-center justify-center gap-2",[a(o.slug),p.value===o.slug?"scale-105 shadow-2xl":""]])},[p.value===o.slug?(l(),i("div",ps)):f("",!0),n[5]||(n[5]=e("svg",{class:"w-5 h-5 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1)),e("span",hs,r(o.slug==="free"?s.$t("pricing.useFree"):s.$t("pricing.buyNow")),1)],10,gs),o.slug==="premium"&&p.value===o.slug?(l(),i("div",ms," ‚≠ê "+r(s.$t("pricing.popularChoice")),1)):f("",!0)],46,Jt))),128))]))]),g.value?(l(),q(zt,{key:0,plan:w.value,onClose:n[2]||(n[2]=o=>g.value=!1),onSuccess:A},null,8,["plan"])):f("",!0)]))}},ys=G(vs,[["__scopeId","data-v-ffc165f1"]]);export{ys as default};
